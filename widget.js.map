{"version":3,"sources":["widget.js"],"names":["onDomContentLoaded","init","setTimeout","_bftn_animations","_bftn_options","animation","start","delay","Array","always_show_widget","window","location","href","indexOf","_bftn_util","getCookie","setCookie","viewCookieExpires","injectCSS","iframe_base_path","debug","date","Date","actionCookieExpires","theme","main","options","modalAnimation","keys","Object","k","length","this","createIframe","bindIframeCommunicator","document","getElementById","stop","destroyIframe","id","css","style","createElement","type","styleSheet","cssText","appendChild","createTextNode","head","wrapper","iframe","src","frameBorder","allowTransparency","display","body","parentNode","removeChild","sendMessage","requestType","data","BFTN_WIDGET_MSG","contentWindow","postMessage","eventMethod","addEventListener","eventer","e","BFTN_IFRAME_MSG","name","val","expires","exdays","d","setTime","getTime","toGMTString","cookie","cname","c","ca","split","i","trim","substring","log","console","apply","arguments","readyState"],"mappings":"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","file":"widget.js","sourcesContent":["(function() {\r\n  if (typeof _bftn_options == \"undefined\") _bftn_options = {};\r\n  if (typeof _bftn_options.iframe_base_path == \"undefined\") _bftn_options.iframe_base_path = 'https://widget.battleforthenet.com/iframe';\r\n  if (typeof _bftn_options.animation == \"undefined\") _bftn_options.animation = 'main';\r\n  if (typeof _bftn_options.delay == \"undefined\") _bftn_options.delay = 1000;\r\n  if (typeof _bftn_options.debug == \"undefined\") _bftn_options.debug = false;\r\n  if (typeof _bftn_options.date == \"undefined\") _bftn_options.date = new Date(2017, 11 /* Zero-based month */, 14);\r\n  if (typeof _bftn_options.viewCookieExpires == \"undefined\") _bftn_options.viewCookieExpires = 1;\r\n  if (typeof _bftn_options.actionCookieExpires == \"undefined\") _bftn_options.actionCookieExpires = 7;\r\n  if (typeof _bftn_options.always_show_widget == \"undefined\") _bftn_options.always_show_widget = false;\r\n  if (typeof _bftn_options.theme == \"undefined\") _bftn_options.theme = 'countdown';\r\n\r\n  var _bftn_animations = {\r\n    main: {\r\n      options: {\r\n        modalAnimation: 'main'\r\n      },\r\n      init: function(options) {\r\n        var keys = Object.keys(options);\r\n        for (var k = 0; k < keys.length; k++) {\r\n          this.options[keys[k]] = options[keys[k]];\r\n        }\r\n\r\n        return this;\r\n      },\r\n      start: function() {\r\n        var iframe = _bftn_util.createIframe();\r\n        _bftn_util.bindIframeCommunicator(document.getElementById('_bftn_iframe'), this);\r\n      },\r\n      stop: function() {\r\n        _bftn_util.destroyIframe();\r\n      }\r\n    }\r\n  }\r\n\r\n  var _bftn_util = {\r\n    injectCSS: function(id, css) {\r\n      var style = document.createElement('style');\r\n      style.type = 'text/css';\r\n      style.id = id;\r\n      if (style.styleSheet) style.styleSheet.cssText = css;\r\n      else style.appendChild(document.createTextNode(css));\r\n      document.head.appendChild(style);\r\n    },\r\n\r\n    createIframe: function() {\r\n      var wrapper = document.createElement('div');\r\n      wrapper.id = '_bftn_wrapper';\r\n      var iframe = document.createElement('iframe');\r\n      iframe.id = '_bftn_iframe';\r\n      iframe.src = _bftn_options.iframe_base_path + '/iframe.html';\r\n      iframe.frameBorder = 0;\r\n      iframe.allowTransparency = true; \r\n      iframe.style.display = 'none';\r\n      wrapper.appendChild(iframe);\r\n      document.body.appendChild(wrapper);\r\n      return wrapper;\r\n    },\r\n\r\n    destroyIframe: function() {\r\n      var iframe = document.getElementById('_bftn_wrapper');\r\n      iframe.parentNode.removeChild(iframe);\r\n    },\r\n\r\n    bindIframeCommunicator: function(iframe, animation) {\r\n      function sendMessage(requestType, data) {\r\n        data || (data = {});\r\n        data.requestType = requestType;\r\n        data.BFTN_WIDGET_MSG = true;\r\n        iframe.contentWindow.postMessage(data, '*');\r\n      }\r\n\r\n      var eventMethod = window.addEventListener ? \"addEventListener\" : \"attachEvent\";\r\n      var eventer = window[eventMethod];\r\n      var messageEvent = eventMethod == \"attachEvent\" ? \"onmessage\" : \"message\";\r\n\r\n      eventer(messageEvent, function(e) {\r\n        if (!e.data || !e.data.BFTN_IFRAME_MSG) return;\r\n\r\n        delete e.data.BFTN_IFRAME_MSG;\r\n\r\n        switch (e.data.requestType) {\r\n          case 'getAnimation':\r\n            iframe.style.display = 'block';\r\n            sendMessage('putAnimation', animation.options);\r\n            break;\r\n          case 'stop':\r\n            animation.stop();\r\n            break;\r\n          case 'cookie':\r\n            _bftn_util.setCookie(e.data.name, e.data.val, e.data.expires);\r\n            break;\r\n        }\r\n      }, false);\r\n    },\r\n\r\n    setCookie: function(name, val, exdays) {\r\n      var d = new Date();\r\n      d.setTime(d.getTime()+(exdays*24*60*60*1000));\r\n\r\n      var expires = \"expires=\"+d.toGMTString();\r\n      document.cookie = name + \"=\" + val + \"; \" + expires + \"; path=/\";\r\n    },\r\n\r\n    getCookie: function(cname) {\r\n      var name = cname + \"=\";\r\n      var ca = document.cookie.split(';');\r\n      var c;\r\n\r\n      for(var i = 0; i < ca.length; i++) {\r\n        c = ca[i].trim();\r\n        if (c.indexOf(name) == 0) {\r\n          return c.substring(name.length, c.length);\r\n        }\r\n      }\r\n\r\n      return \"\";\r\n    },\r\n\r\n    log: function() {\r\n      if (_bftn_options.debug) console.log.apply(console, arguments);\r\n    }\r\n  }\r\n\r\n  function onDomContentLoaded() {\r\n    var images = new Array();\r\n    var preloaded = 0;\r\n\r\n    function init() {\r\n      setTimeout(function() {\r\n        _bftn_animations[_bftn_options.animation].init(_bftn_options).start();\r\n      }, _bftn_options.delay);\r\n    }\r\n\r\n    function preload() {\r\n      for (i = 0; i < preload.arguments.length; i++) {\r\n        images[i] = new Image()\r\n        images[i].src = _bftn_options.iframe_base_path + '/images/' + preload.arguments[i]\r\n\r\n        images[i].onload = function() {\r\n          preloaded++;\r\n          _bftn_util.log('Preloaded ' + preloaded + ' images.');\r\n\r\n          if (preloaded == images.length) {\r\n            _bftn_util.log('DONE PRELOADING IMAGES. Starting animation in ' + _bftn_options.delay + ' milliseconds.');\r\n            init();\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Should we show the widget, regardless?\r\n    if (!_bftn_options.always_show_widget && window.location.href.indexOf('ALWAYS_SHOW_BFTN_WIDGET') === -1) {\r\n\r\n      // Don't show widget if cookie has been set.\r\n      if (\r\n        _bftn_util.getCookie('_BFTN_WIDGET_VIEW') ||\r\n        _bftn_util.getCookie('_BFTN_WIDGET_ACTION')\r\n      ) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Only show once per day.\r\n    _bftn_util.setCookie('_BFTN_WIDGET_VIEW', 'true', _bftn_options.viewCookieExpires);\r\n\r\n    _bftn_util.injectCSS('_bftn_iframe_css', '#_bftn_wrapper { position: fixed; left: 0px; top: 0px; width: 100%; height: 100%; z-index: 20000; -webkit-overflow-scrolling: touch; overflow-y: auto; } #_bftn_iframe { width: 100%; height: 100%;  }');\r\n\r\n    // Preload images before showing the animation\r\n    // preload();\r\n    init();\r\n  }\r\n\r\n  // Wait for DOM content to load.\r\n  switch(document.readyState) {\r\n    case 'complete':\r\n    case 'loaded':\r\n    case 'interactive':\r\n      onDomContentLoaded();\r\n      break;\r\n    default:\r\n      if (typeof document.addEventListener === 'function') {\r\n        document.addEventListener('DOMContentLoaded', onDomContentLoaded, false);\r\n      }\r\n  }\r\n})();\r\n"]}